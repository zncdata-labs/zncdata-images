name: test


on:
  pull_request:
    branches:
      - main


jobs:
  prepare:
    name: Prepare Updated data
    uses: ./.github/workflows/reusable-prepare.yaml


  test:
    name: Test
    needs:
      - prepare
    uses: ./.github/workflows/reusable-build-publish.yaml
    with:
      registry: quay.io/zncdatadev
      cache-registry: quay.io/zncdatadev
      targets: ${{ matrix.targets }}
      push: true
    strategy:
      matrix:
        targets: ${{ fromjson(needs.prepare.outputs.targets) }}
      max-parallel: 2
    if: ${{ needs.prepare.outputs.targets != '' }}
